# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Базовый код:

### 1. Класс `API`

Свойства экземпляра класса
baseUrl (тип string) - базовый URL для запросов к API
options (тип RequestInit) - параметры запроса для fetch к API, заданы по умолчанию
\*\*Методы
Все методы возвращают Promise<object>.

\*protected handleResponse
Обрабатывает ответы API. Если статус ответа ok, то возвращает JSON-ответ, иначе - сообщение об ошибке.

\*get
Выполняет HTTP-запрос с методом GET к серверу и обрабатывает ответ с помощью handleResponse.

\*post
Выполняет HTTP-запрос к серверу с методом, который может быть POST, PUT или DELETE (передается в качестве параметра ApiPostMethods), и обрабатывает ответ с помощью handleResponse.

### 2. Класс `EventEmitter`

Свойства экземпляра класса
\_events: Map<EventName, Set<Subscriber>> - Коллекция, где ключ - это название события (type EventName = string | RegExp), а значение - это множество уникальных функций-подписчиков (type Subscriber = Function).
\*\*Методы
Эти методы ничего не возвращают.

\*on
Проверяет, существует ли множество функций-подписчиков для данного события. Если нет, создается новое множество. Если оно существует, добавляет предоставленную функцию-подписчик в это множество.

\*off
Удаляет предоставленную функцию-подписчик (callback) для данного события. Если для события нет функций-подписчиков, событие удаляется.

\*emit
Вызывает все функции-подписчики с предоставленными данными (data), если название события совпадает с предоставленным.

\*onAll
Добавляет предоставленную функцию-подписчик ко всем событиям в коллекции.

\*offAll
Очищает коллекцию подписчиков и событий, создавая новую, пустую коллекцию.

\*trigger
Возвращает функцию, которая вызовет функции-подписчики для предоставленного события с данными, переданными в качестве аргумента.

### 3. Абстрактный класс `Component  `

- Это абстрактный класс, поэтому он не может быть создан напрямую, только через наследование.
- У экземпляров дочерних классов будет свойство container типа HTMLElement.
- Все методы, кроме render(), ничего не возвращают, они просто модифицируют DOM-элементы.
- Метод render() является абстрактным, поэтому он должен быть реализован в дочерних классах.
- Методы setText(), setImage(), setHidden() и setVisible() помечены как protected, что означает, что они доступны только внутри класса и его наследников.

### 4. Абстрактный класс `Model`

- Экземпляр дочернего класса содержит данные о модели;
- Методы ничего не возвращают
  Метод emitChanges() вызывает все функции-подписчики для указанного события, передавая им опциональные данные.

## Классы предметной области

### 1. Класс `Card`

Карточка - это компонент, унаследованный от Component, который отвечает за отображение информации о товаре.
Состояние карточки хранится в интерфейсе ICard<T>, который включает в себя:

- name: название товара
- image: URL изображения товара
- category: категория товара
- cost: стоимость товара
- description: описание товара
- button: кнопка, связанная с карточкой

* Методы
  -- get и set свойств
  Компонент Card предоставляет геттеры и сеттеры для всех свойств, определенных в ICard<T>.

Подклассы
От класса Card наследуются два подкласса:

CardPreview - представляет собой карточку с полной информацией о товаре, отображаемую при нажатии на карточку в каталоге.
CardBasket - представляет собой карточку товара, добавленного в корзину.

### 2. Класс `Page`

Компонент Page - это класс, унаследованный от Component, который отвечает за отображение основной страницы приложения.
Состояние страницы хранится в интерфейсе IPage, который включает в себя:

- productCount: количество отображаемых товаров
- catalog: массив HTML-элементов, представляющих карточки товаров
- isLocked: флаг блокировки страницы

Методы
set productCount, set catalog, set isLocked
Сеттеры для изменения соответствующих свойств, определенных в IPage.

Компонент Page не вводит дополнительных специфичных для себя методов, кроме сеттеров.

### 3. Класс `Order`

Компонент Order - это класс, унаследованный от Form, который отвечает за обработку оформления заказа
Состояние заказа хранится в интерфейсе IOrderForm, который включает в себя:

- phone: номер телефона
- email: email

Методы
set phone, set email
Сеттеры для изменения соответствующих полей формы заказа, определенных в IOrderForm.

Компонент Order не вводит дополнительных специфичных для себя методов, кроме сеттеров.

### 4. Класс `Contacts`

Компонент Contacts - это класс, унаследованный от Form, который отвечает за обработку формы контактной информации.

Состояние формы контактов хранится в интерфейсе IContactsForm, который включает в себя:

- address: адрес
- paymentOptions: массив кнопок для выбора способа оплаты
- nextButton: кнопка "Далее"
- paymentType: выбранный способ оплаты

Методы
set address
Сеттер для изменения значения поля адреса, определенного в IContactsForm.

Обработчики кликов
При клике на кнопку способа оплаты - присваивается значение paymentType
При клике на кнопку "Далее" - генерируется событие открытия следующего модального окна с телефоном и email
Компонент Contacts не вводит дополнительных специфичных для себя методов, кроме сеттера и обработчиков кликов.

### 5. Класс `WebLarekAPI`

Класс WebLarekAPI наследуется от класса Api и реализует интерфейс IWebLarekAPI. Этот класс отвечает за взаимодействие с API интернет-магазина WebLarek.

Класс WebLarekAPI содержит следующие приватные поля:

- url: базовый URL для запросов к API
- headers: стандартные заголовки, используемые при выполнении запросов

Методы

- getCardList
  Возвращает Promise, который разрешается массивом товаров. Выполняет GET-запрос к API для получения списка товаров.

- getCardItem
  Возвращает Promise, который разрешается информацией о конкретном товаре. Выполняет GET-запрос к API для получения данных о товаре.

- orderCard
  Возвращает Promise, который разрешается после оформления заказа. Выполняет POST-запрос к API для оформления заказа товара.

Все методы класса WebLarekAPI возвращают Promise, который разрешается соответствующими данными, полученными от API.

### 6. Класс `AppState`

Класс AppState наследуется от Model и реализует интерфейс IAppState. Он отвечает за управление состоянием приложения.

Класс AppState содержит следующие поля:

- catalog: массив элементов, соответствующих интерфейсу карточки
- basket: массив строковых идентификаторов товаров в корзине
- previewLotId: идентификатор лота для предварительного просмотра
- order: объект с контактными данными и массивом идентификаторов товаров
- formErrors: объект с ошибками формы

Методы

- toggleOrderedLot
  Добавляет или удаляет товар из корзины, обновляя массив basket.

- clearBasket
  Очищает корзину, устанавливая basket равным пустому массиву.

- getTotal
  Возвращает общую сумму товаров в корзине.

- setCatalog
  Устанавливает список товаров в catalog.

- getLots
  Возвращает каталог карточек, хранящийся в catalog.

- setPreview
  Устанавливает previewLotId для предварительного просмотра карточки.

- setOrderField
  Устанавливает значение в поле ввода заказа, обновляя соответствующее свойство в order.

- validateOrder
  Проверяет обязательные поля для оформления заказа и записывает ошибки в formErrors.

Класс AppState предоставляет методы для управления состоянием приложения, такими как корзина, каталог, предварительный просмотр и валидация формы заказа.

### 1. Класс `Basket`

1. Класс Basket наследует от Component и использует интерфейс IBasketView.
2. В конструкторе находятся и сохраняются ссылки на DOM-элементы: массив товаров, итоговая стоимость, кнопка оформления заказа.
3. При клике на кнопку "Оформить" генерируется событие "order".
4. Сеттер items устанавливает текст для элементов массива товаров. Если массив пуст, выводится "Корзина пуста".
5. Сеттер total устанавливает текст для элемента итоговой стоимости.
6. Сеттер selected блокирует/разблокирует кнопку оформления заказа в зависимости от наличия выбранных товаров.

### 2. Класс `Form`

Форма заказа - это компонент, унаследованный от Component, который отвечает за сбор и валидацию данных пользователя для оформления заказа.
Форма хранит состояние в интерфейсе IFormState, который включает в себя:

- valid: булевое значение, определяющее, валидна ли форма
- errors: массив строк, содержащий ошибки валидации

* Методы:
  \*\*onInputChange
  Этот метод генерирует событие inputChange, передавая актуальные данные формы.

\*\*set valid
Сеттер, блокирующий кнопку отправки, если форма не валидна.

\*\* set errors
Сеттер, устанавливающий текст ошибки в элемент span.

\*\* render
Метод, обновляющий валидацию формы.

### 3. Класс `Modal`

Модальное окно - это компонент, унаследованный от Component, который отвечает за отображение модального окна с пользовательским контентом.
Модальное окно хранит состояние в интерфейсе IModalData, который включает в себя:

- content: HTML-элемент, который будет отображаться в модальном окне
  В конструкторе компонента происходит поиск и инициализация следующих DOM-элементов:

- Кнопка закрытия модального окна
- Контейнер модального окна
  Также в конструкторе подписываются обработчики событий:

- Клик на кнопку закрытия - закрывает модальное окно
- Клик вне контейнера модального окна - закрывает модальное окно
- Клик на контент модального окна - предотвращает закрытие окна

* Методы:

- set content
  Сеттер, устанавливающий содержимое модального окна.

- open
  Метод, который добавляет класс modal_active к контейнеру модального окна и генерирует событие modalOpen.

- close
  Метод, который удаляет класс modal_active из контейнера модального окна, очищает его содержимое и генерирует событие modalClose.

- render
  Метод, который обновляет содержимое модального окна и открывает его.

### 4. Класс `Success`

Модальное окно "Успешный заказ" - это компонент, унаследованный от Modal, который отвечает за отображение модального окна с информацией об успешном оформлении заказа.

Модальное окно "Успешный заказ" хранит состояние в интерфейсе ISuccess, который включает в себя:

- orderCost: стоимость оформленного заказа
  Класс Success наследует все методы от родительского класса Modal, а также не вводит дополнительных специфичных для себя методов.

### 5. Класс `Tabs`

Компонент Tabs - это кнопка, унаследованная от Component, которая отвечает за отображение и управление состоянием вкладок.

Состояние вкладки хранится в интерфейсе TabState, который включает в себя:

- state: строка, представляющая состояние вкладки

Методы

- set state
  Сеттер, который проверяет, совпадает ли значение, передаваемое в качестве параметра, с именем кнопки, и блокирует ее состояние в соответствии с этим.

Класс Tabs не вводит дополнительных специфичных для себя методов, кроме set state.
