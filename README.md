# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/common.blocks/ — папка с стилями компонентов

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

## IProduct - Интерфейс для описания одной идиницы товара

export interface IProduct {
id: string;
title: string;
price: number | null;
description: string;
category: string;
image: string;
}

## IBasket - Интерфейс для описания корзины

export interface IBasket {
items: string[];
total: number;
}

## IOrder - Интерфейс описания заказа

export interface IOrder {
payment: PaymentMethod;
email: string;
phone: string;
address: string;
total: number;
items: string[];
}

## Вспомогательные интрефейсы для работы с формами

export type OrderForm = Omit<IOrder, 'total' | 'items'>;
export type OrderField = {
field: keyof OrderForm;
value: string
}
export interface IOrderResult {
id: string;
total: number;
}

## класс AppData

Для хранеия данных, который хранит все данные приложения
данный класс хранит массив всех продуктов, корзину, данные о заказе которые заполняет пользователь
и товар который открываеться в отдельном окно

В конструкторе принимает экземпляр событий и генерирует события:
`items:change` - изменение массива товаров каталога
`preview:change` - изменение открываемого в модальном окне товара
`basket:change` - изменение списка товаров корзины
`formErrors:change` - изменение ошибки валидации форм

export class AppData {
items: IProduct[] = [];
basket: IBasket = {
items: [],
total: 0
};
preview: IProduct = null;
order: IOrder = {
payment: 'card',
email: '',
phone: '',
address: '',
items: [],
total: 0
}

formErrors: Partial<Record<keyof OrderForm, string>> = {};

## LarekAPI класс для аработы с данными

явл дочерним от класс api
в данном классе реализовали три метода

- позволяет получить массив продуктов с сервера
- получает один продукт с сервера
- отправляетб на сервер заказ

class LarekAPI extends Api implements ILarekAPI {
readonly cdn: string;
constructor(cdn: string, baseUrl: string, options?: RequestInit) {
super(baseUrl, options);
this.cdn = cdn;
}
// получаем информацию о продукте по id
getProductItem(id: string): Promise<IProduct> {}

    // отправляем заказ на сервер
    orderProducts(order: IOrder): Promise<IOrderResult> {}

    // получаем список продуктов
    getProductList(): Promise<IProduct[]> {}

## Класс Component

Базовый класс для работы с HTML.
Класс предоставляет методы для управления элементами DOM: переключение классов, управление видимостью, изменение текста и изображений, а также блокировка элементов. Основной метод render используется для отображения данных в компоненте, обновления его состояния и возврата ссылки на элемент DOM для дальнейшего взаимодействия.

## Component<T>

- Конструктор: Принимает контейнер (HTML-элемент), в котором будет размещен компонент.
- Метод toggleClass: Добавляет или удаляет CSS-класс у элемента в зависимости от переданного флага force.
- Метод setText: Устанавливает текстовое содержимое элемента.
- Метод setImage: Устанавливает источник и альтернативный текст для изображения.
- Метод render: Обновляет данные компонента на основе переданного объекта и возвращает контейнер.

## View<T>

Конструктор: Расширяет Component и добавляет обработчик событий (events). Инициализирует родительский класс с заданным контейнером.

## Класс Form

Form — базовый класс для работы с HTML-формами. Обрабатывает ввод данных, проверку, установку ошибок и отправку формы. При изменении полей генерирует события (например, contacts:submit или order:submit). Основной метод render отображает состояние формы, включая ошибки и валидность.

- Конструктор: Принимает экземпляр EventEmitter и HTML-форму. Инициализирует элементы формы, такие как кнопка отправки и контейнер для ошибок, а также настраивает обработчики событий.
- Метод \_setupEventListeners: Добавляет обработчики событий для ввода данных и отправки формы.
- Метод \_handleInputChange: Обрабатывает изменения в полях ввода, извлекает имя поля и его значение, и вызывает метод onInputChange.
- Метод \_handleFormSubmit: Предотвращает стандартное поведение отправки формы и генерирует событие отправки.
- Метод onInputChange: Вызывает событие изменения поля, передавая имя поля и его значение.
- Сеттер valid: Устанавливает состояние кнопки отправки (активна/неактивна) в зависимости от валидности данных.
- Сеттер errors: Устанавливает текст ошибок в соответствующий элемент формы.
- Метод render: Обновляет состояние формы, включая поля ввода, ошибки и их валидность, и возвращает контейнер формы.

## Класс Modal

Класс Modal управляет модальным окном, предоставляя методы для его открытия, закрытия и рендеринга содержимого.

- Конструктор: Принимает экземпляр событий и контейнер (HTML-элемент) для модального окна. Инициализирует элементы закрытия и содержимого модального окна, а также настраивает обработчики событий.
- Метод \_setupEventListeners: Добавляет обработчики событий для кнопки закрытия, всего контейнера и содержимого модального окна, предотвращая закрытие при клике на содержимое.
- Сеттер content: Устанавливает содержимое модального окна. Если передано значение, оно заменяет текущее содержимое; если нет, очищает содержимое.
- Метод open: Открывает модальное окно, добавляя класс активности и генерируя событие modal:open.
- Метод close: Закрывает модальное окно, удаляя класс активности, очищает содержимое и генерирует событие modal:close.
- Метод render: Обновляет данные модального окна, открывает его и возвращает контейнер.

## Класс Card

Класс Card отвечает за отображение информации о товаре в карточке, заполняя соответствующие поля (\_title, \_price, \_image и др.) на основе данных товара.

- Конструктор: Принимает контейнер (HTML-элемент) и необязательные действия (actions). Инициализирует элементы карточки (заголовок, цена, изображение, описание, категория и кнопка) и настраивает действия.
- Метод \_setupActions: Добавляет обработчик события клика на кнопку или на весь контейнер, если указаны действия.

### Сеттеры и геттеры:

- id: Устанавливает и получает идентификатор карточки.
- title: Устанавливает и получает заголовок карточки.
- category: Устанавливает категорию карточки, обновляет класс для стилизации.
- price: Устанавливает цену карточки. Если цена отсутствует, отображает "Бесценно" и управляет состоянием кнопки.
- image: Устанавливает изображение карточки.
- button: Устанавливает текст кнопки.
- description: Устанавливает текст описания карточки.

## Класс Api

Класс Api предоставляет базовую логику для отправки HTTP-запросов, включая методы для выполнения запросов GET и POST.

- ApiListResponse<Type>: Определяет структуру ответа API, содержащую общее количество элементов (total) и массив элементов (items) указанного типа.
- ApiPostMethods: Перечисление методов HTTP-запросов, поддерживающих операции записи (POST, PUT, DELETE).

### Свойства:

- baseUrl: Базовый URL для API.
- options: Параметры для запросов, включая заголовки (по умолчанию Content-Type установлен в application/json).
- Конструктор: Инициализирует baseUrl и options, устанавливая заголовки.
- Метод handleResponse: Обрабатывает ответ от сервера. Если ответ успешен (response.ok), возвращает JSON. В противном случае возвращает ошибку.
- Метод get: Выполняет GET-запрос по указанному URI и обрабатывает ответ.
- Метод post: Выполняет POST-запрос (или другие методы, такие как PUT, DELETE, если указаны) с передачей данных в теле запроса и обработкой ответа.

## Класс EventEmmiter

Позволяет отправлять события и подписываться на них, обеспечивая взаимодействие между уровнем данных и пользовательским интерфейсом.

- Свойство \_events: Карта, хранящая подписанные события и соответствующие им обработчики.
- Конструктор: Инициализирует \_events как пустую карту.
- Метод on: Подписывает обработчик на указанное событие. Если событие еще не существует, создается новая запись.
- Метод off: Удаляет обработчик из события. Если после удаления не осталось подписчиков, событие удаляется.
- Метод emit: Генерирует событие, вызывая все соответствующие обработчики, которые подписаны на это событие или соответствуют регулярному выражению.
- Метод onAll: Позволяет подписаться на все события, используя специальное имя \*.
- Метод offAll: Очищает все подписки, сбрасывая карту событий.
- Метод trigger: Возвращает функцию, которая генерирует событие с контекстом и данными при вызове.

## - Класс Contacts управляет вводом контактной информации (электронной почты и телефона) в форме, обеспечивая возможность установки значений и обработку ошибок при отсутствии соответствующих полей.

- Конструктор: Принимает экземпляр EventEmitter и HTML-форму. Вызывает конструктор родительского класса Form.
- Сеттер email: Устанавливает значение поля ввода электронной почты, используя метод \_setInputValue.
- Сеттер phone: Устанавливает значение поля ввода телефона, также используя метод \_setInputValue.
- Метод \_setInputValue: Принимает имя поля и значение, находит соответствующий элемент формы и устанавливает его значение. Если элемент не найден, выводит предупреждение в консоль.

## Класс Success

Отвечает за отображение содержимого окна успешного выполнения заказа.

- Конструктор: Принимает контейнер (HTML-элемент) и действия (actions). Инициализирует элементы для кнопки закрытия и описания, а также настраивает обработчики событий.
- Метод \_setupActions: Добавляет обработчик события клика на кнопку закрытия, если в действиях указана функция.
- Сеттер total: Устанавливает текст описания, обновляя его с сообщением о списании указанного количества "синапсов".

## Класс Order управляет формой заказа, включая выбор метода оплаты и установку адреса.

- Свойства: \_paymentButtons: Объект с кнопками для выбора метода оплаты (карта и наличные).
- Конструктор: Инициализирует форму и кнопки оплаты, настраивает обработчики событий для кнопок.
- Метод \_initializePaymentButtons: Добавляет обработчики клика на кнопки, устанавливая выбранный метод оплаты и вызывая событие изменения.
- Сеттер payment: Обновляет состояние кнопок, выделяя активный метод оплаты.
- Сеттер address: Устанавливает значение для поля адреса.
- Метод \_setInputValue: Устанавливает значение для указанного поля формы и выводит предупреждение, если поле не найдено.

## Класс Page управляет основными элементами страницы, включая счетчик корзины, каталог товаров и состояние блокировки.

### Свойства:

- \_counter: Элемент для отображения счетчика корзины.
- \_catalog: Элемент для отображения каталога товаров.
- \_basket: Элемент корзины.
- \_wrapper: Обертка страницы.

### Конструктор: Инициализирует элементы страницы и настраивает обработчик для открытия корзины.

- Метод \_initializeBasket: Добавляет обработчик события клика на корзину, который генерирует событие basket:open.
- Сеттер counter: Устанавливает текст счетчика корзины.
- Сеттер catalog: Обновляет содержимое каталога товара.
- Сеттер locked: Добавляет или удаляет класс блокировки у обертки страницы.
